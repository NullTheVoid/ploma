
<html>
<head>
	<style type="text/css">
	html, body {
	 width: 100%;
	 height: 100%;
	}

	#sketch {
		border: 10px solid gray;
		height: 100%;
		position: relative;
	}

	#tmp_canvas {
    cursor: url('../../cursor.cur'), crosshair; /* created at cursor.cc */
		position: absolute;
		left: 0px; right: 0;
		bottom: 0; top: 0;
		/*cursor: crosshair;*/
	}
	</style>
</head>
<body>
<div id="sketch">
	<canvas id="paint"></canvas>
</div>
<script>
(function() {
  
  var sketch = document.querySelector('#sketch');
  var sketch_style = getComputedStyle(sketch);
  
  // Creating a tmp canvas
  var tmp_canvas = document.createElement('canvas');
  var tmp_ctx = tmp_canvas.getContext('2d');
  tmp_canvas.id = 'tmp_canvas';
  tmp_canvas.width = 1000;
  tmp_canvas.height = 1000;
  
  sketch.appendChild(tmp_canvas);

  var mouse = {x: 0, y: 0};
  var start_mouse = {x: 0, y: 0};
  var last_mouse = {x: 0, y: 0};
  
  var sprayIntervalID;
  
  /* Mouse Capturing Work */
  tmp_canvas.addEventListener('mousemove', function(e) {
    mouse.x = typeof e.offsetX !== 'undefined' ? e.offsetX : e.layerX;
    mouse.y = typeof e.offsetY !== 'undefined' ? e.offsetY : e.layerY;
  }, false);
  
  /* Drawing on Paint App */
  //tmp_ctx.fillStyle = 'blue';
  
  tmp_canvas.addEventListener('mousedown', function(e) {
    tmp_canvas.addEventListener('mousemove', onPaint, false);
    
    mouse.x = typeof e.offsetX !== 'undefined' ? e.offsetX : e.layerX;
    mouse.y = typeof e.offsetY !== 'undefined' ? e.offsetY : e.layerY;
    
    start_mouse.x = mouse.x;
    start_mouse.y = mouse.y;
    
    onPaint();
    sprayIntervalID = setInterval(onPaint, 20);
  }, false);
  
  tmp_canvas.addEventListener('mouseup', function() {
    tmp_canvas.removeEventListener('mousemove', onPaint, false);
    clearInterval(sprayIntervalID);
  }, false);
  
  var onPaint = function() {
    var x = mouse.x;
    var y = mouse.y;
    generateSprayParticles();
  };
  
  var getRandomOffset = function(radius) {
    var random_angle = Math.random() * (2*Math.PI);
    var random_radius = Math.random() * radius;
    return {
      x: Math.cos(random_angle) * random_radius,
      y: Math.sin(random_angle) * random_radius
    };
  };
  
  var generateSprayParticles = function() {
    // Particle count, or, density
    var density = 50;
    for (var i = 0; i < density; i++) {
      var radius = 1;
      var offset = getRandomOffset(radius);
      var x = mouse.x + offset.x;
      var y = mouse.y + offset.y;
      var d = Math.sqrt((x - mouse.x)*(x - mouse.x) + (y - mouse.y)*(y - mouse.y));
      //console.log(d/100);
      tmp_ctx.fillStyle = "rgba(0,0,0,"+(1-(d/radius))+");"; 
      tmp_ctx.fillRect(x, y, 1, 1);
    }
  };
  
}());
</script>
</body>
</html>