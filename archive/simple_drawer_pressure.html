<html>
  <head>
    <!-- FONT -->
    <link rel="stylesheet" type="text/css" href="http://assets.tumblr.com/fonts/bodonirecutfs/stylesheet.css?v=3"><link rel="stylesheet" type="text/css" href="http://assets.tumblr.com/fonts/newsgothicfs/stylesheet.css?v=3">

    <!-- CSS -->
    <style>
      h1, h3 {
        font-family:'Bodoni Recut FS', serif;
      }
      canvas {
        border: 1px solid black;
        cursor: url('cursor.cur'), crosshair; /* created at cursor.cc */
      }
      object {
        background: white;
        border: 1px solid black;
        opacity: 0;
      }
    </style>

    <!-- WACOM JS -->
    <script>
      window.onload = function() {
        startRead();
      };

      // Get the Wacom plugin
      function getWacomPlugin() {
        var plugin = document.getElementById('wtPlugin');
        return plugin;
      }

      // Set a timer to read the Wacom pressure
      function startRead() {
        timeoutID = window.setTimeout(returnRead, 500);
      }

      // Read the Wacom pressure
      // Set the canvas stroke color based on the pressure
      function returnRead() {
        var p = getWacomPlugin().penAPI.pressure;
        var el = document.getElementById('c');
        console.log('pressure: ' + p);
        console.log('canvas: ' + el);
        if(el) {
          var ctx = el.getContext('2d');
          ctx.setStrokeColor(0, 0, 0, p);
        }
        startRead();
      }
    </script>

  </head>

  <body>
    <!-- HEADER -->
    <h1>Ploma</h1>
    
    <!-- CANVAS -->
    <canvas id="c" width="500" height="300"></canvas>

    <!-- WACOM PLUGIN -->
    <object id="wtPlugin" type="application/x-wacomtabletplugin">
      <param name="onload" value="pluginLoaded" />
    </object>

  </body>

  <!-- CANVAS JS -->
  <script>
    var el = document.getElementById('c');
    var ctx = el.getContext('2d');
    var isDrawing;
    var oldX;
    var oldY;

    // Set isDrawing to true
    // Record the mouse position
    el.onmousedown = function(e) {
      isDrawing = true;
      oldX = e.clientX - el.offsetLeft + 8;
      oldY = e.clientY - el.offsetTop + 8;
    };

    // Start a path
    // Move to old mouse position
    // Draw line to new mouse position
    // Close the path and stroke
    // Reset the old mouse position to new mouse position
    el.onmousemove = function(e) {
      if (isDrawing) {
        ctx.beginPath(); // begins the current path
        ctx.moveTo(oldX, oldY);
        ctx.lineTo(
          e.clientX - el.offsetLeft + 8,
          e.clientY - el.offsetTop + 8
        );
        ctx.stroke();
        ctx.closePath(); // closes the current path
        oldX = e.clientX - el.offsetLeft + 8;
        oldY = e.clientY - el.offsetTop + 8;
      }
    };

    // Set isDrawing to false
    el.onmouseup = function() {
      isDrawing = false;
    };
  </script>

</html>