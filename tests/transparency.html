<html>
	<head>
	</head>
	<body>
    <img src="rubbing_to_mask.jpg" id="image"/>
	</body>
  <script type="text/javascript">
    // get the image
    var img = document.getElementById("image");
    // create and customize the canvas
    var canvas = document.createElement("canvas");
    canvas.width = 87;
    canvas.height = 277;
    document.body.appendChild(canvas);
    // get the context
    var ctx = canvas.getContext("2d");
    // draw the image into the canvas
    ctx.drawImage(img, 0, 0);

    // get the image data object
    var image = ctx.getImageData(0, 0, 87, 277);
    // get the image data values
    var imageData = image.data,
    length = imageData.length;
    // set every fourth value to 50
    //for(var i=3; i < length; i+=4){ 
    //  imageData[i] = 50;
    //}
    for(var i=0; i < length; i+=4) {
      var r = imageData[i];
      var g = imageData[i+1];
      var b = imageData[i+2];
      var a = imageData[i+3];
      var hsl = rgbToHsl(r, g, b);
      var l = hsl[2];
      //console.log(l*255);
      imageData[i] = 0;
      imageData[i+1] = 0;
      imageData[i+2] = 0;
      imageData[i+3] = 255 - l*255;
    }
    // after the manipulation, reset the data
    image.data = imageData;
    // and put the imagedata back to the canvas
    ctx.putImageData(image, 0, 0);

    img.src = canvas.toDataURL();

    /**
    * Converts an RGB color value to HSL. Conversion formula
    * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
    * Assumes r, g, and b are contained in the set [0, 255] and
    * returns h, s, and l in the set [0, 1].
    *
    * @param Number r The red color value
    * @param Number g The green color value
    * @param Number b The blue color value
    * @return Array The HSL representation
    */
    function rgbToHsl(r, g, b) {
      r /= 255, g /= 255, b /= 255;
       
      var max = Math.max(r, g, b), min = Math.min(r, g, b);
      var h, s, l = (max + min) / 2;
       
      if (max == min) {
      h = s = 0; // achromatic
      } else {
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
       
      switch (max) {
      case r: h = (g - b) / d + (g < b ? 6 : 0); break;
      case g: h = (b - r) / d + 2; break;
      case b: h = (r - g) / d + 4; break;
      }
       
      h /= 6;
      }
       
      return [ h, s, l ];
    }
  </script>
</html>